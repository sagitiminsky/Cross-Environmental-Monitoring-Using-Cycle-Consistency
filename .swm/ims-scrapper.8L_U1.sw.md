---
id: 8L_U1
name: IMS scrapper
file_version: 1.0.2
app_version: 0.7.1-2
file_blobs:
  CellEnMon/libs/scrappers/ims_scrapper/scrapper.py: 1c06349cbc8591e8558c75507151df7fa1c42567
  CellEnMon/config.py: 08c0ccbd89f6d81fa8892ecc1598531f6a363af1
---

TLDR: python3 `ðŸ“„ CellEnMon/libs/scrappers/ims_scrapper/scrapper.py`

send go to [https://ims.gov.il/he/ObservationDataAPI](https://ims.gov.il/he/ObservationDataAPI) you will find the API documenation and you'll be able to fill in the following form [https://ims.gov.il/sites/default/files/docs/terms\_0.pdf](https://ims.gov.il/sites/default/files/docs/terms_0.pdf) and send it back to [&#105;&#109;&#115;&#64;&#x69;&#109;&#115;&#x2e;&#103;&#x6f;&#118;&#x2e;&#x69;&#x6c;](mailto:ims@ims.gov.il).

After receiving the approval from the ims you will be provided with an API Token, if you want, you can keep that in secret - put that in your gitignore file.

I've created a small requirements file: `ðŸ“„ CellEnMon/libs/scrappers/ims_scrapper/requirements.txt`  
if you are not intresented to run the learning script, and you are only interested in the data. Make sure to run it:  
pip3 install -r `ðŸ“„ CellEnMon/libs/scrappers/ims_scrapper/requirements.txt`

`ðŸ“„ CellEnMon/libs/scrappers/ims_scrapper/requirements.txt`

<br/>

There are two options to run the script:  
1\. DOWNLOAD - download from the ims API endpoint  
2\. UPLOAD - uploads data to a managed bucket in my gcs
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ CellEnMon/libs/scrappers/ims_scrapper/scrapper.py
```python
ðŸŸ© 17     SELECTOR = ['DOWNLOAD','UPLOAD']  # DOWNLOAD | UPLOAD
```

<br/>

you can use the following token to verify that everything works for you
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ CellEnMon/config.py
```python
ðŸŸ© 79     ims_token = 'f058958a-d8bd-47cc-95d7-7ecf98610e47'
ðŸŸ© 80     ims_mapping=[
â¬œ 81         {
â¬œ 82             "stationId": 2,
â¬œ 83             "name": "AVNE ETAN",
â¬œ 84             "shortName": "AVNE ETA",
â¬œ 85             "stationsTag": "(None)",
â¬œ 86             "location": {
â¬œ 87                 "latitude": 32.817,
â¬œ 88                 "longitude": 35.763
â¬œ 89             },
â¬œ 90             "timebase": 10,
â¬œ 91             "active": True,
â¬œ 92             "owner": "ims",
â¬œ 93             "regionId": 8,
â¬œ 94             "monitors": [
â¬œ 95                 {
```

<br/>

This is how we are going to GET from the ims endpoint
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ CellEnMon/libs/scrappers/ims_scrapper/scrapper.py
```python
â¬œ 26     class IMS_Scrapper_obj:
â¬œ 27         def __init__(self, index, station_id, station_name, location, _from, _to):
â¬œ 28             self.index = index
â¬œ 29             self.station_id = station_id
â¬œ 30             self._from = _from
â¬œ 31             self._to = _to
â¬œ 32             self.root = config.ims_root_files
â¬œ 33             self.station_id = station_id
â¬œ 34             self.station_name = station_name
â¬œ 35             self.station_location = location
ðŸŸ© 36             self.station_data = f"https://api.ims.gov.il/v1/envista/stations/{station_id}/data/?from={_from}&to={_to}"
â¬œ 37             self.bucket = client.get_bucket('cell_en_mon')
```

<br/>

If you download the files locally, you will see it in the following path: /CellEnMon/datasets/ims/raw/

<br/>

To control the dates in the ims, you can change the dates in the config file:
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ CellEnMon/config.py
```python
â¬œ 29         }
â¬œ 30     
â¬œ 31     
ðŸŸ© 32     date = {
ðŸŸ© 33         'value': {
ðŸŸ© 34             'dd': '01',
ðŸŸ© 35             'mm': '01',
ðŸŸ© 36             'yyyy': '2013'
ðŸŸ© 37         },
ðŸŸ© 38         'value_range': {
ðŸŸ© 39             'dd': '02',
ðŸŸ© 40             'mm': '01',
ðŸŸ© 41             'yyyy': '2013'
ðŸŸ© 42         }
ðŸŸ© 43     }
â¬œ 44     
â¬œ 45     date_str_rep = add_days_to_date(date['value'])['str_rep_with_replace'] + '_' + add_days_to_date(date['value_range'])[
â¬œ 46         'str_rep_with_replace']
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBQ2VsbEVuTW9uLVJlc2VhcmNoJTNBJTNBc2FnaXRpbWluc2t5/docs/8L_U1).